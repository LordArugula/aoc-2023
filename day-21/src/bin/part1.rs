fn main() {
  let input = include_str!("./input.txt");
  let output = part_one(input, 64);
  println!("{}", output);
}


fn part_one(input: &str, num_steps: usize) -> u32 {
  let map = input.lines()
    .map(|line| line.chars().collect::<Vec<_>>())
    .collect::<Vec<_>>();

  let start = map.iter()
    .enumerate()
    .find_map(|(row, l)| {
      match l.iter().position(|&c| c == 'S') {
        Some(col) => Some((row, col)),
        None => None  
      }
    })
    .expect("Should have an 'S'");
  
  let mut open_space = vec![start];
  let mut next_spaces = std::collections::HashSet::new();
  let mut num_steps_taken = 0;
  while num_steps_taken < num_steps {
    open_space.extend(next_spaces.iter());
    next_spaces.clear();
    
    while let Some((row, col)) = open_space.pop() {
      if row + 1 < map.len() && map[row + 1][col] != '#' {
        next_spaces.insert((row + 1, col));
      }
  
      if col + 1 < map[row].len() && map[row][col + 1] != '#' {
        next_spaces.insert((row, col + 1));
      }
  
      if row > 0 && map[row - 1][col] != '#' {
        next_spaces.insert((row - 1, col));
      }
  
      if col > 0 && map[row][col - 1] != '#' {
        next_spaces.insert((row, col - 1));
      }
    }

    num_steps_taken += 1;
  }

  map.iter()
    .enumerate()
    .for_each(|(row, line)| {
      line.iter()
        .enumerate()
        .for_each(|(col, ch)| {
          if next_spaces.contains(&(row, col)) {
            print!("O");
          } else {
            print!("{}", ch); 
          }
        });
      println!();
    });
  
  next_spaces.len() as u32
}

#[cfg(test)]
mod test {
  use super::*;

  #[test]
  fn test_part_one() {
    assert_eq!(part_one("...........
.....###.#.
.###.##..#.
..#.#...#..
....#.#....
.##..S####.
.##..#...#.
.......##..
.##.#.####.
.##..##.##.
...........", 6), 16);
  }

  #[test]
  fn test_part_one_big_10() {
    assert_eq!(part_one(".................................
.....###.#......###.#......###.#.
.###.##..#..###.##..#..###.##..#.
..#.#...#....#.#...#....#.#...#..
....#.#........#.#........#.#....
.##...####..##...####..##...####.
.##..#...#..##..#...#..##..#...#.
.......##.........##.........##..
.##.#.####..##.#.####..##.#.####.
.##..##.##..##..##.##..##..##.##.
.................................
.................................
.....###.#......###.#......###.#.
.###.##..#..###.##..#..###.##..#.
..#.#...#....#.#...#....#.#...#..
....#.#........#.#........#.#....
.##...####..##..S####..##...####.
.##..#...#..##..#...#..##..#...#.
.......##.........##.........##..
.##.#.####..##.#.####..##.#.####.
.##..##.##..##..##.##..##..##.##.
.................................
.................................
.....###.#......###.#......###.#.
.###.##..#..###.##..#..###.##..#.
..#.#...#....#.#...#....#.#...#..
....#.#........#.#........#.#....
.##...####..##...####..##...####.
.##..#...#..##..#...#..##..#...#.
.......##.........##.........##..
.##.#.####..##.#.####..##.#.####.
.##..##.##..##..##.##..##..##.##.
.................................", 10), 50);
  }

  #[test]
  fn test_part_one_big_33() {
    assert_eq!(part_one("...................................................................................................
.....###.#......###.#......###.#......###.#......###.#......###.#......###.#......###.#......###.#.
.###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#.
..#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#..
....#.#........#.#........#.#........#.#........#.#........#.#........#.#........#.#........#.#....
.##...####..##...####..##...####..##...####..##...####..##...####..##...####..##...####..##...####.
.##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#.
.......##.........##.........##.........##.........##.........##.........##.........##.........##..
.##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####.
.##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##.
...................................................................................................
...................................................................................................
.....###.#......###.#......###.#......###.#......###.#......###.#......###.#......###.#......###.#.
.###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#.
..#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#..
....#.#........#.#........#.#........#.#........#.#........#.#........#.#........#.#........#.#....
.##...####..##...####..##...####..##...####..##...####..##...####..##...####..##...####..##...####.
.##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#.
.......##.........##.........##.........##.........##.........##.........##.........##.........##..
.##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####.
.##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##.
...................................................................................................
...................................................................................................
.....###.#......###.#......###.#......###.#......###.#......###.#......###.#......###.#......###.#.
.###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#.
..#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#..
....#.#........#.#........#.#........#.#........#.#........#.#........#.#........#.#........#.#....
.##...####..##...####..##...####..##...####..##...####..##...####..##...####..##...####..##...####.
.##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#.
.......##.........##.........##.........##.........##.........##.........##.........##.........##..
.##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####.
.##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##.
...................................................................................................
...................................................................................................
.....###.#......###.#......###.#......###.#......###.#......###.#......###.#......###.#......###.#.
.###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#.
..#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#..
....#.#........#.#........#.#........#.#........#.#........#.#........#.#........#.#........#.#....
.##...####..##...####..##...####..##...####..##...####..##...####..##...####..##...####..##...####.
.##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#.
.......##.........##.........##.........##.........##.........##.........##.........##.........##..
.##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####.
.##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##.
...................................................................................................
...................................................................................................
.....###.#......###.#......###.#......###.#......###.#......###.#......###.#......###.#......###.#.
.###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#.
..#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#..
....#.#........#.#........#.#........#.#........#.#........#.#........#.#........#.#........#.#....
.##...####..##...####..##...####..##...####..##..S####..##...####..##...####..##...####..##...####.
.##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#.
.......##.........##.........##.........##.........##.........##.........##.........##.........##..
.##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####.
.##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##.
...................................................................................................
...................................................................................................
.....###.#......###.#......###.#......###.#......###.#......###.#......###.#......###.#......###.#.
.###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#.
..#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#..
....#.#........#.#........#.#........#.#........#.#........#.#........#.#........#.#........#.#....
.##...####..##...####..##...####..##...####..##...####..##...####..##...####..##...####..##...####.
.##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#.
.......##.........##.........##.........##.........##.........##.........##.........##.........##..
.##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####.
.##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##.
...................................................................................................
...................................................................................................
.....###.#......###.#......###.#......###.#......###.#......###.#......###.#......###.#......###.#.
.###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#.
..#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#..
....#.#........#.#........#.#........#.#........#.#........#.#........#.#........#.#........#.#....
.##...####..##...####..##...####..##...####..##...####..##...####..##...####..##...####..##...####.
.##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#.
.......##.........##.........##.........##.........##.........##.........##.........##.........##..
.##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####.
.##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##.
...................................................................................................
...................................................................................................
.....###.#......###.#......###.#......###.#......###.#......###.#......###.#......###.#......###.#.
.###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#.
..#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#..
....#.#........#.#........#.#........#.#........#.#........#.#........#.#........#.#........#.#....
.##...####..##...####..##...####..##...####..##...####..##...####..##...####..##...####..##...####.
.##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#.
.......##.........##.........##.........##.........##.........##.........##.........##.........##..
.##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####.
.##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##.
...................................................................................................
...................................................................................................
.....###.#......###.#......###.#......###.#......###.#......###.#......###.#......###.#......###.#.
.###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#.
..#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#..
....#.#........#.#........#.#........#.#........#.#........#.#........#.#........#.#........#.#....
.##...####..##...####..##...####..##...####..##...####..##...####..##...####..##...####..##...####.
.##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#.
.......##.........##.........##.........##.........##.........##.........##.........##.........##..
.##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####.
.##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##.
...................................................................................................", 33), 644);
  }

  #[test]
  fn test_part_one_big_50() {
    assert_eq!(part_one("...................................................................................................
.....###.#......###.#......###.#......###.#......###.#......###.#......###.#......###.#......###.#.
.###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#.
..#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#..
....#.#........#.#........#.#........#.#........#.#........#.#........#.#........#.#........#.#....
.##...####..##...####..##...####..##...####..##...####..##...####..##...####..##...####..##...####.
.##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#.
.......##.........##.........##.........##.........##.........##.........##.........##.........##..
.##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####.
.##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##.
...................................................................................................
...................................................................................................
.....###.#......###.#......###.#......###.#......###.#......###.#......###.#......###.#......###.#.
.###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#.
..#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#..
....#.#........#.#........#.#........#.#........#.#........#.#........#.#........#.#........#.#....
.##...####..##...####..##...####..##...####..##...####..##...####..##...####..##...####..##...####.
.##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#.
.......##.........##.........##.........##.........##.........##.........##.........##.........##..
.##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####.
.##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##.
...................................................................................................
...................................................................................................
.....###.#......###.#......###.#......###.#......###.#......###.#......###.#......###.#......###.#.
.###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#.
..#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#..
....#.#........#.#........#.#........#.#........#.#........#.#........#.#........#.#........#.#....
.##...####..##...####..##...####..##...####..##...####..##...####..##...####..##...####..##...####.
.##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#.
.......##.........##.........##.........##.........##.........##.........##.........##.........##..
.##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####.
.##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##.
...................................................................................................
...................................................................................................
.....###.#......###.#......###.#......###.#......###.#......###.#......###.#......###.#......###.#.
.###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#.
..#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#..
....#.#........#.#........#.#........#.#........#.#........#.#........#.#........#.#........#.#....
.##...####..##...####..##...####..##...####..##...####..##...####..##...####..##...####..##...####.
.##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#.
.......##.........##.........##.........##.........##.........##.........##.........##.........##..
.##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####.
.##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##.
...................................................................................................
...................................................................................................
.....###.#......###.#......###.#......###.#......###.#......###.#......###.#......###.#......###.#.
.###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#.
..#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#..
....#.#........#.#........#.#........#.#........#.#........#.#........#.#........#.#........#.#....
.##...####..##...####..##...####..##...####..##..S####..##...####..##...####..##...####..##...####.
.##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#.
.......##.........##.........##.........##.........##.........##.........##.........##.........##..
.##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####.
.##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##.
...................................................................................................
...................................................................................................
.....###.#......###.#......###.#......###.#......###.#......###.#......###.#......###.#......###.#.
.###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#.
..#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#..
....#.#........#.#........#.#........#.#........#.#........#.#........#.#........#.#........#.#....
.##...####..##...####..##...####..##...####..##...####..##...####..##...####..##...####..##...####.
.##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#.
.......##.........##.........##.........##.........##.........##.........##.........##.........##..
.##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####.
.##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##.
...................................................................................................
...................................................................................................
.....###.#......###.#......###.#......###.#......###.#......###.#......###.#......###.#......###.#.
.###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#.
..#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#..
....#.#........#.#........#.#........#.#........#.#........#.#........#.#........#.#........#.#....
.##...####..##...####..##...####..##...####..##...####..##...####..##...####..##...####..##...####.
.##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#.
.......##.........##.........##.........##.........##.........##.........##.........##.........##..
.##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####.
.##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##.
...................................................................................................
...................................................................................................
.....###.#......###.#......###.#......###.#......###.#......###.#......###.#......###.#......###.#.
.###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#.
..#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#..
....#.#........#.#........#.#........#.#........#.#........#.#........#.#........#.#........#.#....
.##...####..##...####..##...####..##...####..##...####..##...####..##...####..##...####..##...####.
.##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#.
.......##.........##.........##.........##.........##.........##.........##.........##.........##..
.##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####.
.##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##.
...................................................................................................
...................................................................................................
.....###.#......###.#......###.#......###.#......###.#......###.#......###.#......###.#......###.#.
.###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#..###.##..#.
..#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#....#.#...#..
....#.#........#.#........#.#........#.#........#.#........#.#........#.#........#.#........#.#....
.##...####..##...####..##...####..##...####..##...####..##...####..##...####..##...####..##...####.
.##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#..##..#...#.
.......##.........##.........##.........##.........##.........##.........##.........##.........##..
.##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####..##.#.####.
.##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##..##..##.##.
...................................................................................................", 50), 1594);
  }
}
